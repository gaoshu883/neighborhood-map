<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <title>array filter</title>
    <link rel="stylesheet" type="text/css" href="style/app.css">
</head>

<body>
    <div id="map"></div>

    <!-- 搜索条 -->
    <div class="search-panel search-bar">
      <!-- 消除inline-block元素之间的间距 -->
        <span class="search-panel-btn toggle-list" data-bind="click:toggleList,text:toggleMenuText">List</span><div class="search-dropbox" data-bind="style:{width:searchBoxSelected()?'55%':''}"><label for="searchBox">Filter locations by name or type</label><input class="search-box" id="searchBox" data-bind="value:tempFilterName,click:setSearchFocused" placeholder="Search here..."><div class="search-city" data-bind="style:{display:searchBoxSelected()?'inline-block':''}"><span>Now you are in: </span><label for="searchCity">Enter your favorite location:</label><input class="search-box" id="searchCity" data-bind="value:cityName,event:{change:changeCityName}"></div></div><span class="fontawesome-search search-panel-btn search-btn" data-bind="style:{display:searchBoxSelected()?'inline-block':''},click:fetchLocations"></span><span class="fontawesome-filter search-panel-btn filter-list" data-bind="click:toggleFilter"></span>

        <!-- 这里显示所有的类别 -->
        <!-- 向下效果滑出 -->
        <div class="category-list" data-bind="style:{display:filterStatus() ? 'block':''},foreach:categoryList">
            <span class="category-name" data-bind="text:name,event:{click:$parent.setCurrentFilter}"></span>
        </div>

    </div>

    <!-- 地点列表 -->
    <!-- 列表存在性判断:map不显示并且存在筛选出的地点 -->
    <div class="search-panel locations-list" data-bind="style:{display:!detailsStatus()&&!mapStatus()&&filterLocations().length!==0? 'block':''},css:listCSS">
        <!-- ko foreach:filterLocations -->
            <div class="location-item" data-bind="click:$parent.showDetails">
                <div>
                    <span data-bind="text:$index() + 1"></span>
                    <span data-bind="text:name"></span>
                    <span data-bind="text:rating"></span>
                </div>
                <p data-bind="text:address[0]"></p>
            </div>
        <!-- /ko -->
    </div>
    <div class="search-panel locations-notFound" data-bind="style:{display:currentFilter().name() && (filterLocations().length == 0)? 'block':''}">
        <p>Not Found</p>
    </div>


    <!-- 地点详情 -->
    <div id="locationDetails" class="location-details" data-bind="style:{display:detailsStatus()&&!listStatus()&&!mapStatus()&&currentLocation()? 'block':''},with:currentLocation">
        <div class="fontawesome-angle-left location-details-close-icon" data-bind="click:$parent.hideDetails"></div>
        <div><img class="location-img" data-bind="attr: { src: photo.visibility == 'public' ? photo.prefix+'500x300'+photo.suffix : $parent.imageHolder, alt: name }"></div>
        <p><span data-bind="text:name"></span><span data-bind="text:rating"></span></p>
        <p data-bind="text:category"></p>
        <p data-bind="text:address"></p>
        <div data-bind="visible:hours,with:hours">
            <p data-bind="visible:isOpen,text:status"></p>
            <p data-bind="visible:!isOpen,text: 'Close now!'"></p>
        </div>
        <p data-bind="text:contact"></p>
        <p><a data-bind="attr: {href:url}"></a></p>
        <p class="show-map-btn"><button data-bind="click:$parent.showMap">See in the map</button></p>
    </div>


    <script type="text/javascript" src="js/lib/knockout-3.4.1.js"></script>
    <script type="text/javascript" src="js/lib/string.fuzzy.js"></script>
    <script type="text/javascript" src="js/lib/ajax.js"></script>
    <script type="text/javascript" src="js/list-viewModel.js"></script>
    <script type="text/javascript" src="js/models/locationList-data.js"></script>
    <script type="text/javascript" src="js/googleMap.js"></script>
    <script type="text/javascript" src="js/app.js"></script>
    <!--Load the JS API ASYNCHRONOUSLY below.-->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC20z-8QU5oAG87tAJpuWcTa0sPnLTMzsg&callback=app.googleMap.initMap" async defer></script>
</body>

</html>
